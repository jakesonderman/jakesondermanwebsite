<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
<TITLE>ASCII Audio Visualizer - Jake Sonderman</TITLE>
</HEAD>
<BODY BGCOLOR="#FFFFFF" TEXT="#000000" LINK="#000000" VLINK="#000000" ALINK="#000000">
<TABLE WIDTH="100%" BORDER="0" CELLPADDING="20" CELLSPACING="0">
<TR>
<TD>
<CENTER>
<FONT SIZE="+3" FACE="Courier" COLOR="#000000"><B>ASCII AUDIO VISUALIZER</B></FONT>
<BR><BR>
<FONT SIZE="+1" FACE="Courier" COLOR="#000000">Drop an audio file below or click to select</FONT>
<BR><BR>
<DIV ID="dropZone" STYLE="border: 3px dashed #000000; padding: 40px; margin: 20px auto; width: 80%; background-color: #FFFFFF; cursor: pointer; text-align: center;">
<FONT FACE="Courier" SIZE="+1" COLOR="#000000">
<B>DRAG & DROP AUDIO FILE HERE</B><BR>
OR CLICK TO SELECT
</FONT>
</DIV>
<INPUT TYPE="FILE" ID="fileInput" ACCEPT="audio/*" STYLE="display: none;">
<BR><BR>
<DIV ID="audioInfo" STYLE="font-family: Courier; font-size: 14px; margin: 10px; display: none;">
<B>Now Playing:</B> <SPAN ID="fileName"></SPAN>
</DIV>
<BR>
<AUDIO ID="audioPlayer" CONTROLS STYLE="width: 80%; max-width: 600px; display: none;">
Your browser does not support the audio element.
</AUDIO>
<BR><BR>
<CENTER>
<INPUT TYPE="BUTTON" ID="playBtn" VALUE="PLAY" ONCLICK="togglePlay()" STYLE="font-family: Courier; font-size: 14px; padding: 10px 20px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer; display: none;">
<INPUT TYPE="BUTTON" ID="pauseBtn" VALUE="PAUSE" ONCLICK="togglePause()" STYLE="font-family: Courier; font-size: 14px; padding: 10px 20px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer; display: none;">
</CENTER>
<BR><BR>
<DIV ID="visualizerOptions" STYLE="display: none; margin: 20px auto; width: 90%; max-width: 800px;">
<FONT FACE="Courier" SIZE="+1" COLOR="#000000"><B>COLOR OPTIONS:</B></FONT><BR>
<INPUT TYPE="BUTTON" VALUE="BLACK" ONCLICK="setColor('#000000')" STYLE="font-family: Courier; font-size: 12px; padding: 5px 15px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer; color: #000000;">
<INPUT TYPE="BUTTON" VALUE="GREEN" ONCLICK="setColor('#00FF00')" STYLE="font-family: Courier; font-size: 12px; padding: 5px 15px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer; color: #00FF00;">
<INPUT TYPE="BUTTON" VALUE="BLUE" ONCLICK="setColor('#0000FF')" STYLE="font-family: Courier; font-size: 12px; padding: 5px 15px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer; color: #0000FF;">
<INPUT TYPE="BUTTON" VALUE="RED" ONCLICK="setColor('#FF0000')" STYLE="font-family: Courier; font-size: 12px; padding: 5px 15px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer; color: #FF0000;">
<BR><BR>
<FONT FACE="Courier" SIZE="+1" COLOR="#000000"><B>CHARACTER SET:</B></FONT><BR>
<INPUT TYPE="BUTTON" VALUE="STARS (*)" ONCLICK="setChars('*', '.')" STYLE="font-family: Courier; font-size: 12px; padding: 5px 15px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer;">
<INPUT TYPE="BUTTON" VALUE="BARS (|)" ONCLICK="setChars('|', ':')" STYLE="font-family: Courier; font-size: 12px; padding: 5px 15px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer;">
<INPUT TYPE="BUTTON" VALUE="HASH (#)" ONCLICK="setChars('#', '+')" STYLE="font-family: Courier; font-size: 12px; padding: 5px 15px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer;">
<INPUT TYPE="BUTTON" VALUE="AT (@)" ONCLICK="setChars('@', 'O')" STYLE="font-family: Courier; font-size: 12px; padding: 5px 15px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer;">
<INPUT TYPE="BUTTON" VALUE="EQUALS (=)" ONCLICK="setChars('=', '-')" STYLE="font-family: Courier; font-size: 12px; padding: 5px 15px; margin: 5px; border: 2px solid #000000; background-color: #FFFFFF; cursor: pointer;">
</DIV>
<BR><BR>
<PRE ID="scopeVisualizer" STYLE="font-family: Courier; font-size: 10px; background-color: #FFFFFF; color: #000000; padding: 10px; margin: 20px auto; width: 90%; max-width: 800px; height: 300px; overflow: hidden; display: none; border: 2px solid #000000; line-height: 1.1;"></PRE>
<BR><BR>
<CENTER>
<A HREF="index.html"><FONT FACE="Courier" COLOR="#000000">HOME</FONT></A> | 
<A HREF="games.html"><FONT FACE="Courier" COLOR="#000000">GAMES</FONT></A> | 
<A HREF="jeremy.html"><FONT FACE="Courier" COLOR="#000000">JEREMY</FONT></A> | 
<A HREF="contact.html"><FONT FACE="Courier" COLOR="#000000">CONTACT</FONT></A>
</CENTER>
</TD>
</TR>
</TABLE>
<SCRIPT>
var audioPlayer = document.getElementById('audioPlayer');
var fileInput = document.getElementById('fileInput');
var dropZone = document.getElementById('dropZone');
var audioInfo = document.getElementById('audioInfo');
var fileName = document.getElementById('fileName');
var playBtn = document.getElementById('playBtn');
var pauseBtn = document.getElementById('pauseBtn');
var scopeVisualizer = document.getElementById('scopeVisualizer');

// Web Audio API setup
var audioContext = null;
var analyser = null;
var dataArray = null;
var animationFrameId = null;
var source = null;

// Visualizer options
var currentColor = '#000000';
var mainChar = '*';
var nearChar = '.';

// Click drop zone to select file
dropZone.onclick = function() {
  fileInput.click();
};

// File input change
fileInput.onchange = function(e) {
  var file = e.target.files[0];
  if(file) {
    loadAudioFile(file);
  }
};

// Drag and drop handlers
dropZone.ondragover = function(e) {
  e.preventDefault();
  e.stopPropagation();
  dropZone.style.backgroundColor = '#F0F0F0';
};

dropZone.ondragleave = function(e) {
  e.preventDefault();
  e.stopPropagation();
  dropZone.style.backgroundColor = '#FFFFFF';
};

dropZone.ondrop = function(e) {
  e.preventDefault();
  e.stopPropagation();
  dropZone.style.backgroundColor = '#FFFFFF';
  
  var files = e.dataTransfer.files;
  if(files.length > 0) {
    var file = files[0];
    if(file.type.startsWith('audio/')) {
      loadAudioFile(file);
    } else {
      alert('Please drop an audio file (MP3, WAV, OGG, etc.)');
    }
  }
};

function loadAudioFile(file) {
  var reader = new FileReader();
  
  reader.onload = function(e) {
    var audioUrl = e.target.result;
    audioPlayer.src = audioUrl;
    fileName.textContent = file.name;
    audioInfo.style.display = 'block';
    audioPlayer.style.display = 'block';
    playBtn.style.display = 'inline-block';
    pauseBtn.style.display = 'inline-block';
    
    // Setup Web Audio API
    setupAudioContext();
  };
  
  reader.readAsDataURL(file);
}

function setupAudioContext() {
  // Create audio context if it doesn't exist
  if(!audioContext) {
    try {
      audioContext = new (window.AudioContext || window.webkitAudioContext)();
      analyser = audioContext.createAnalyser();
      analyser.fftSize = 2048;
      analyser.smoothingTimeConstant = 0.3;
      
      // Connect audio element to analyser (this disconnects default output, so we reconnect)
      source = audioContext.createMediaElementSource(audioPlayer);
      source.connect(analyser);
      analyser.connect(audioContext.destination);
      
      // Create data array for waveform data (time domain)
      var bufferLength = analyser.fftSize;
      dataArray = new Uint8Array(bufferLength);
      
      // Show visualizer and options
      scopeVisualizer.style.display = 'block';
      document.getElementById('visualizerOptions').style.display = 'block';
      
      // Start visualization loop
      visualize();
    } catch(e) {
      console.error('Error setting up audio context:', e);
      alert('Error setting up audio visualization: ' + e.message);
    }
  }
}

function visualize() {
  if(!analyser || !dataArray) {
    console.log('Analyser or dataArray not ready');
    return;
  }
  
  // Cancel any existing animation
  if(animationFrameId) {
    cancelAnimationFrame(animationFrameId);
  }
  
  function draw() {
    // Always continue the loop
    animationFrameId = requestAnimationFrame(draw);
    
    if(!analyser || !dataArray) return;
    
    // Get waveform data (time domain - actual audio buffer samples)
    analyser.getByteTimeDomainData(dataArray);
    
    // Create ASCII scope visualization - extended to edges
    var width = 100;
    var height = 25;
    var output = '';
    
    // Create grid
    for(var y = 0; y < height; y++) {
      var line = '';
      for(var x = 0; x < width; x++) {
        // Map x to dataArray index
        var dataIndex = Math.floor((x / width) * dataArray.length);
        var value = dataArray[dataIndex];
        
        // Normalize value (0-255, where 128 is center) to height
        // Value 128 = center, 0 = bottom, 255 = top
        var normalizedValue = ((value - 128) / 128) * (height / 2);
        var yPos = Math.floor((height / 2) - normalizedValue);
        yPos = Math.max(0, Math.min(height - 1, yPos));
        
        if(y === yPos) {
          line += mainChar; // Waveform point
        } else if(Math.abs(y - yPos) === 1) {
          line += nearChar; // Near waveform
        } else {
          line += ' '; // Empty space
        }
      }
      output += line + '\n';
    }
    
    scopeVisualizer.textContent = output;
    scopeVisualizer.style.color = currentColor;
  }
  
  draw();
}

function setColor(color) {
  currentColor = color;
  scopeVisualizer.style.color = color;
}

function setChars(main, near) {
  mainChar = main;
  nearChar = near;
}

function togglePlay() {
  // Resume audio context if suspended (browser autoplay policy)
  if(audioContext) {
    if(audioContext.state === 'suspended') {
      audioContext.resume().then(function() {
        audioPlayer.play();
      });
    } else {
      audioPlayer.play();
    }
  } else {
    audioPlayer.play();
  }
}

function togglePause() {
  audioPlayer.pause();
}

// Update button states based on audio playback
audioPlayer.onplay = function() {
  playBtn.style.display = 'none';
  pauseBtn.style.display = 'inline-block';
  // Ensure audio context is running
  if(audioContext && audioContext.state === 'suspended') {
    audioContext.resume();
  }
};

audioPlayer.onpause = function() {
  playBtn.style.display = 'inline-block';
  pauseBtn.style.display = 'none';
};

audioPlayer.onended = function() {
  playBtn.style.display = 'inline-block';
  pauseBtn.style.display = 'none';
};
</SCRIPT>
</BODY>
</HTML>

